type: "transformation"
version: "1.0"
pipeline:
  components:
    CUSTOMERS:
      type: "table-input"
      parameters:
        componentName: "CUSTOMERS"
        database: "[Environment Default]"
        schema: "MATILLION"
        targetTable: "CUSTOMERS"
        columnNames:
        - "CUSTOMER_ID"
        - "FIRST_NAME"
        - "LAST_NAME"
        - "EMAIL"
        - "PHONE"
        - "CREATED_AT"
        - "IS_ACTIVE"
        timeOffset:
    SQL:
      type: "sql"
      parameters:
        componentName: "SQL"
        query: "SELECT order_id,\r\n    customer_id,\r\n    order_date,\r\n    status,\r\
          \n    total_amount\r\nFROM DBT_DEMO.MATILLION.ORDERS"
    Join:
      type: "join"
      sources:
      - "SQL"
      - "Filter 2"
      - "REVIEWS"
      parameters:
        componentName: "Join"
        mainTable: "Filter 2"
        mainTableAlias: "CUS"
        joins:
        - - "SQL"
          - "ORD"
          - "Full"
        - - "REVIEWS"
          - "REV"
          - "Full"
        joinExpressions:
        - - "\"CUS\".\"CUSTOMER_ID\"=\"ORD\".\"CUSTOMER_ID\""
          - "CUS_Full_ORD"
        - - "\"CUS\".\"CUSTOMER_ID\"=\"REV\".\"CUSTOMER_ID\""
          - "CUS_Full_REV"
        columnMappings:
        - - "CUS.CUSTOMER_ID"
          - "CUSTOMER_ID"
        - - "CUS.FIRST_NAME"
          - "FIRST_NAME"
        - - "CUS.LAST_NAME"
          - "LAST_NAME"
        - - "CUS.EMAIL"
          - "EMAIL"
        - - "CUS.PHONE"
          - "PHONE"
        - - "CUS.CREATED_AT"
          - "CREATED_AT"
        - - "CUS.IS_ACTIVE"
          - "IS_ACTIVE"
        - - "ORD.ORDER_ID"
          - "ORDER_ID"
        - - "ORD.ORDER_DATE"
          - "ORDER_DATE"
        - - "ORD.STATUS"
          - "STATUS"
        - - "ORD.TOTAL_AMOUNT"
          - "TOTAL_AMOUNT"
        - - "REV.RATING"
          - "RATING"
    Map Values:
      type: "map-values"
      sources:
      - "Join"
      parameters:
        componentName: "Map Values"
        valueMap:
        - - "STATUS"
          - "Is"
          - "Equal to"
          - "ACTIVE"
          - "INACTIVE"
        columnName: "STATUS_matched"
        other: "STATUS_other"
    Filter 2:
      type: "filter"
      sources:
      - "CUSTOMERS"
      parameters:
        componentName: "Filter 2"
        filterConditions:
        - - "LAST_NAME"
          - "Is"
          - "Null or blank"
          - "IS_ACTIVE"
        combineCondition: "And"
    REVIEWS:
      type: "table-input"
      parameters:
        componentName: "REVIEWS"
        database: "[Environment Default]"
        schema: "MATILLION"
        targetTable: "REVIEWS"
        columnNames:
        - "REVIEW_ID"
        - "CUSTOMER_ID"
        - "PRODUCT_ID"
        - "RATING"
        - "COMMENT"
        - "REVIEW_DATE"
        timeOffset:
    Calculator:
      type: "calculator"
      sources:
      - "Map Values"
      parameters:
        componentName: "Calculator"
        includeInputColumns: "Yes"
        calculations:
        - - "\"LAST_NAME\" + ' ' + \"FIRST_NAME\""
          - "FULLNAME"
    CUSTOMER_ORDERS_VW:
      type: "table-output"
      sources:
      - "Calculator"
      parameters:
        componentName: "CUSTOMER_ORDERS_VW"
        warehouse: "[Environment Default]"
        database: "DBT_DEMO"
        schema: "MATILLION"
        targetTable: "CUSTOMER_ORDERS_VW"
        fixDataTypeMismatches: "No"
        columnMapping:
        - - "CUSTOMER_ID"
          - "CUSTOMER_ID"
        - - "FIRST_NAME"
          - "NAME"
        - - "LAST_NAME"
          - "SURNAME"
        - - "EMAIL"
          - "EMAIL"
        - - "PHONE"
          - "PHONE"
        - - "CREATED_AT"
          - "CREATED"
        - - "IS_ACTIVE"
          - "ACTIVE"
        - - "ORDER_ID"
          - "ORDER_ID"
        - - "ORDER_DATE"
          - "ORDER_DATE"
        - - "STATUS"
          - "STATUS"
        - - "TOTAL_AMOUNT"
          - "AMOUNT"
        - - "RATING"
          - "RATING"
        - - "STATUS_matched"
          - "STATUS_MATCHED"
        - - "FULLNAME"
          - "FULLNAME"
        orderBy:
        outputMode: "Append"
      postProcessing:
        updateOutputMessage:
        updateScalarVariables:
design:
  components:
    CUSTOMERS:
      position:
        x: 790
        "y": 320
      tempMetlId: 1
    SQL:
      position:
        x: 790
        "y": 430
      tempMetlId: 2
    Join:
      position:
        x: 1060
        "y": 320
      tempMetlId: 3
    Map Values:
      position:
        x: 1240
        "y": 320
      tempMetlId: 4
    Filter 2:
      position:
        x: 910
        "y": 320
      tempMetlId: 5
    REVIEWS:
      position:
        x: 790
        "y": 530
      tempMetlId: 7
    Calculator:
      position:
        x: 1390
        "y": 320
      tempMetlId: 8
    CUSTOMER_ORDERS_VW:
      position:
        x: 1540
        "y": 320
      tempMetlId: 10
